(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b62d1ac4"],{"1c9f":function(a,t,e){"use strict";var s=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"PersonalCard"},[a.isAdmin||a.isDelete?e("van-image",{staticClass:"img-style",attrs:{width:"100%",height:"200",fit:"contain",src:a.cardData.identityImg}}):a._e(),e("van-image",{staticClass:"img-style",attrs:{width:"100%",height:"250",fit:"contain",src:a.cardData.userImg}}),e("div",{staticClass:"div-wrapper",staticStyle:{display:"flex","align-items":"center"}},[e("span",{staticClass:"label-style"},[a._v("姓名：")]),a._v(a._s(a.cardData.nickname)+" "),e("van-image",{staticStyle:{"margin-left":"8px"},attrs:{width:"20",height:"20",round:"",src:1===a.cardData.gender?a.male:a.female}})],1),e("div",{staticClass:"div-wrapper"},[e("span",{staticClass:"label-style"},[a._v("学院：")]),a._v(a._s(a.cardData.college)+" ")]),e("div",{staticClass:"div-wrapper"},[e("span",{staticClass:"label-style"},[a._v("出生日期：")]),a._v(a._s(a.cardData.bornDate&&a.moment(a.cardData.bornDate).format("YYYY-MM-DD"))+" ")]),e("div",{staticClass:"div-wrapper"},[e("span",{staticClass:"label-style"},[a._v("身高：")]),a._v(a._s(a.cardData.height)+"cm ")]),e("div",{staticClass:"div-wrapper"},[e("span",{staticClass:"label-style"},[a._v("手机：")]),a._v(a._s(a.cardData.phoneNumber||a.isAdmin?a.cardData.phoneNumber:"保密中...")+" ")]),e("div",{staticClass:"div-wrapper"},[e("span",{staticClass:"label-style"},[a._v("学号：")]),a._v(a._s(a.cardData.schoolNumber||a.isAdmin?a.cardData.schoolNumber:"保密中...")+" ")]),e("div",{staticClass:"div-wrapper"},[e("span",{staticClass:"label-style"},[a._v("QQ/微信：")]),a._v(a._s(a.cardData.qq)+" ")]),e("div",{staticClass:"div-wrapper"},[e("span",{staticClass:"label-style"},[a._v("家乡：")]),a._v(a._s(a.cardData.city)+" ")]),e("div",{staticClass:"div-wrapper"},[e("span",{staticClass:"label-style"},[a._v("兴趣爱好：")]),a._l(a.cardData.hobby,(function(t,s){return e("van-tag",{staticStyle:{margin:"2px"},attrs:{mark:"",color:a.color[s%a.color.length]}},[a._v(" "+a._s(t)+" ")])}))],2),e("div",{staticClass:"div-wrapper"},[e("span",{staticClass:"label-style"},[a._v("个人介绍：")]),a._v(" "+a._s(a.cardData.introduction)+" ")]),a.isAdmin?e("div",{staticClass:"button-wrapper"},[e("van-button",{attrs:{type:"primary",size:"large",round:"",color:"linear-gradient(to right, #37d6b6, #0ac2c9)"},on:{click:function(t){return a.handleActive(!0)}}},[a._v("通过 ")]),e("van-button",{attrs:{type:"danger",size:"large",round:"",color:"linear-gradient(to right, #fd3e30, #ff7d36)"},on:{click:function(t){return a.handleActive(!1)}}},[a._v("不通过 ")])],1):a._e(),a.isDelete?e("van-button",{staticStyle:{"margin-top":"30px"},attrs:{type:"danger",size:"large",round:"",color:"linear-gradient(to right, #42dc84, #02b8e2)"},on:{click:function(t){return a.handleReset()}}},[a._v("重置密码 ")]):a._e(),a.isDelete?e("van-button",{staticStyle:{"margin-top":"30px"},attrs:{type:"danger",size:"large",round:"",color:"linear-gradient(to right, #fd3e30, #ff7d36)"},on:{click:function(t){return a.handleDelete()}}},[a._v("删除 ")]):a._e(),a.isRemove?e("van-button",{staticStyle:{"margin-top":"30px"},attrs:{type:"danger",size:"large",round:"",color:"linear-gradient(to right, #fd3e30, #ff7d36)"},on:{click:function(t){return a.handleRemove()}}},[a._v("移除列表 ")]):a._e()],1)},i=[],n=e("d6a1"),r=e("c32d"),o=["#7232dd","#f2826a","#ff361e","#fa5a5a","#f17db1","#ffcb05","#42dc84","#02b8e2","#a6ce39","#0080ff"],c={name:"PersonalCard",props:{cardData:Object,isAdmin:Boolean,isDelete:Boolean,isRemove:Boolean},data:function(){return{male:e("8880"),female:e("6067"),color:o}},methods:{moment:r,handleActive:function(a){var t=this;n["a"].userController.userActive({userId:this.cardData.userId,code:a?1:2}).then((function(e){e.data.data&&e.data.meta.success?a?t.$toast.success("已通过"):t.$toast.fail("已拒绝"):t.$notify({type:"danger",message:e.data.meta.message}),t.$emit("handleClosePop")}))},handleDelete:function(){var a=this;this.$dialog.confirm({title:"删除",message:"删除后需重新注册，请问确定删除?"}).then((function(){n["a"].userController.deleteUser({userId:a.cardData.userId}).then((function(t){t?t.data.data&&t.data.meta.success?(a.$emit("handleClosePop"),a.$toast.success("已删除")):a.$toast.fail(t.data.meta.message):a.$toast.fail("网络错误")}))})).catch((function(){}))},handleReset:function(){var a=this;this.$dialog.confirm({title:"重置密码",message:"确定重置密码?"}).then((function(){n["a"].userController.resetPassword({userId:a.cardData.userId}).then((function(t){t?(a.$emit("handleClosePop"),a.$toast.success("已重置")):a.$toast.fail(t.data.meta.message)}))})).catch((function(){}))},handleRemove:function(){var a=this;this.$dialog.confirm({title:"移除",message:"确定将其移除我喜欢的列表?"}).then((function(){n["a"].userController.removeLove({userId:a.cardData.userId,love:!0}).then((function(t){t?(a.$emit("handleClosePop"),a.$toast.success("已移除")):a.$toast.fail(t.data.meta.message)}))})).catch((function(){}))}}},l=c,d=(e("ae20"),e("2877")),h=Object(d["a"])(l,s,i,!1,null,"224f0c1d",null);t["a"]=h.exports},"4fe8":function(a,t,e){a.exports=e.p+"img/plant.d44f5275.png"},6067:function(a,t,e){a.exports=e.p+"img/female.2ec0578c.png"},"6a8b":function(a,t,e){a.exports=e.p+"img/match.f24567d7.png"},8880:function(a,t,e){a.exports=e.p+"img/male.ab8cf6ca.png"},"912b":function(a,t,e){},ae20:function(a,t,e){"use strict";var s=e("e731"),i=e.n(s);i.a},b2c3:function(a,t,e){a.exports=e.p+"img/water.424e584f.png"},c9ef:function(a,t,e){a.exports=e.p+"img/doubt.696837cc.png"},ce9d:function(a,t,e){"use strict";e.r(t);var s=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"WishPage"},[e("van-nav-bar",{attrs:{title:"许愿树","left-text":"返回","left-arrow":""},on:{"click-left":a.onClickLeft}}),e("div",{staticClass:"main-wrapper"},[e("van-icon",{staticClass:"doubt-wrapper",attrs:{name:a.doubt,size:"38"},on:{click:a.showTips}}),e("transition",{attrs:{name:"van-fade"}},[e("van-icon",{directives:[{name:"show",rawName:"v-show",value:a.showWater,expression:"showWater"}],staticClass:"water-wrapper",attrs:{name:a.water,size:"160"}})],1),e("div",{staticClass:"card-wrapper"},[e("van-icon",{directives:[{name:"show",rawName:"v-show",value:a.isMatch&&!(a.wishCardData.finisher&&Object.keys(a.wishCardData.finisher).length),expression:"isMatch && !(wishCardData.finisher && Object.keys(wishCardData.finisher).length)"}],staticClass:"match-wrapper",attrs:{name:a.match,size:"120"},on:{click:a.handleConfirm}}),e("transition",{attrs:{name:"van-slide-down"}},[Object.keys(a.wishCardData).length?e("WishCard",{directives:[{name:"show",rawName:"v-show",value:a.cardVisible,expression:"cardVisible"}],attrs:{wishCardData:a.wishCardData},on:{showPersonalData:a.showPersonalData}}):e("van-empty",{attrs:{description:"种子们正在赶来的路上"}})],1)],1)],1),e("div",{staticClass:"plant-tree-wrapper"},[e("div",{staticClass:"func-btn-wrapper"},[e("van-button",{staticClass:"btn-style",attrs:{type:"primary",round:"",size:"large",color:"linear-gradient(to right, #EFE6AE, #BEE8D3)"},on:{click:a.showAnother}},[a._v("换一个 ")]),e("van-button",{staticClass:"btn-style",attrs:{type:"primary",round:"",size:"large",color:"linear-gradient(to right, #89E2D1, #CAD9F0)"},on:{click:a.handleWater}},[a._v("浇水 ")])],1),a.hasSeeding?e("van-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",icon:a.plant,round:"",size:"large",color:"linear-gradient(to right, #4bb0ff, #6149f6)"},on:{click:a.handleRecovery}},[a._v("回收种子 ")]):e("van-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",icon:a.plant,round:"",size:"large",color:"linear-gradient(to right, #ff5559, #ef7f94)"},on:{click:a.showSeeding}},[a._v("播下种子 ")])],1),e("van-popup",{attrs:{closeable:"",position:"bottom"},model:{value:a.showAdd,callback:function(t){a.showAdd=t},expression:"showAdd"}},[e("van-form",{staticClass:"add-wrapper",on:{submit:a.onSubmit}},[e("van-field",{attrs:{label:"一张图片"},scopedSlots:a._u([{key:"input",fn:function(){return[e("van-uploader",{attrs:{multiple:"","max-count":1,"before-read":a.beforeRead},model:{value:a.imgFileList,callback:function(t){a.imgFileList=t},expression:"imgFileList"}})]},proxy:!0}])}),e("van-field",{attrs:{rows:"6",autosize:"",type:"textarea",maxlength:"150","show-word-limit":"",name:"wishText",required:"",label:"你的愿望",placeholder:"请输入你的愿望",rules:[{required:!0,message:"请输入你的愿望!"}]},model:{value:a.wishText,callback:function(t){a.wishText=t},expression:"wishText"}}),e("div",{staticStyle:{margin:"16px"}},[e("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit",loading:a.imgLoading}},[a._v(" 确定 ")])],1)],1)],1),e("van-action-sheet",{attrs:{title:"对方信息"},model:{value:a.cardShow,callback:function(t){a.cardShow=t},expression:"cardShow"}},[e("PersonalCard",{attrs:{cardData:a.personalData},on:{handleClosePop:a.handleClosePop}})],1)],1)},i=[],n=e("d6a1"),r=e("6be6"),o=e.n(r),c=e("3118"),l=e("c59a"),d=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"WishCard",on:{click:a.showPersonalData}},[e("van-image",{attrs:{width:"100%",height:"180px",fit:"contain",src:a.wishCardData.wishImg||"https://img.yzcdn.cn/vant/cat.jpeg"}}),e("div",{staticClass:"time"},[a._v(" "+a._s(a.moment(a.wishCardData.startDate).format("YYYY-MM-DD"))+" ")]),e("div",{staticClass:"text-wrapper"},[a._v(" "+a._s(a.wishCardData.wishText)+" ")])],1)},h=[],u=e("c32d"),p=e.n(u),f={name:"WishCard",props:{wishCardData:Object},methods:{moment:p.a,showPersonalData:function(){this.$emit("showPersonalData")}}},m=f,g=(e("e42b"),e("2877")),v=Object(g["a"])(m,d,h,!1,null,"75f98e5b",null),w=v.exports,b=e("1c9f"),C={name:"WishPage",components:{WishCard:w,PersonalCard:b["a"]},data:function(){return{plant:e("4fe8"),water:e("b2c3"),match:e("6a8b"),doubt:e("c9ef"),cardVisible:!0,showWater:!1,showAdd:!1,imgFileList:[],fileName:"",wishText:"",currentTreeId:"",wishCardData:{},imgLoading:!1,isMatch:!1,cardShow:!1,hasSeeding:!1,personalData:{}}},mounted:function(){this.getWishTree()},methods:{getWishTree:function(){var a=this;return new Promise((function(t,e){n["a"].wishTreeController.getWishTree().then((function(e){e.data.data?(a.isMatch=!!e.data.data.love,a.hasSeeding=!!e.data.data.sowing,a.wishCardData=e.data.data.wishTree||{},e.data.data.wishTree&&e.data.data.wishTree.wisher&&(a.personalData=e.data.data.wishTree.wisher,a.personalData.hobby=a.personalData.hobby&&a.personalData.hobby.split(","))):a.$notify({type:"danger",message:"获取数据错误"}),t()}))}))},onClickLeft:function(){this.$router.push({path:"/mobile/stage"})},showAnother:function(){var a=this;Object.keys(this.wishCardData).length?this.wishCardData.finisher&&Object.keys(this.wishCardData.finisher).length?this.$toast("你们的愿望还未完成哦！"):(this.cardVisible=!1,this.getWishTree().then((function(){a.cardVisible=!0}))):this.$toast("暂无数据！")},handleWater:function(){var a=this;this.showWater=!0,n["a"].wishTreeController.water({id:this.wishCardData.id}).then((function(t){t.data.meta.success?(a.$notify({type:"success",message:t.data.data}),a.cardVisible=!1,a.getWishTree().then((function(){a.cardVisible=!0}))):a.$notify({type:"danger",message:t.data.meta.message}),a.showWater=!1})).catch((function(){a.showWater=!1}))},showSeeding:function(){this.showAdd=!this.showAdd},beforeRead:function(a){var t=this;return new Promise((function(e,s){"image/png"===a.type||"image/jpg"===a.type||"image/jpeg"===a.type?(t.imgLoading=!0,o()(a).then((function(i){var r=new FormData,o=[Object(c["a"])(i.base64,"wish."+i.origin.name.split(".")[1])];o.forEach((function(a){r.append("multipartFiles",a)})),n["a"].userController.uploadAvatar(r).then((function(s){s&&s.data.data?(t.fileName=l["a"].serverBaseController+s.data.data,t.$notify({type:"success",message:"照片已上传"}),e(a),t.imgLoading=!1):(t.$notify({type:"danger",message:"上传失败,请重新上传"}),t.imgLoading=!1)})).catch((function(a){t.$notify({type:"danger",message:"上传失败"}),s()}))})).catch((function(a){this.$notify({type:"danger",message:"图片压缩失败"})}))):(t.$toast("请上传.jpg/.png/.jpeg格式图片"),s())}))},onSubmit:function(){var a=this;n["a"].wishTreeController.addWishTree({wishImg:this.fileName,wishText:this.wishText}).then((function(t){t.data.meta.success?(a.$notify({type:"success",message:t.data.data}),a.showAdd=!1,a.getWishTree()):a.$notify({type:"danger",message:t.data.meta.message})}))},handleConfirm:function(){var a=this;this.$dialog.confirm({title:"确认匹配",message:"确认后无法更换愿望！"}).then((function(){a.handleWater()})).catch((function(){}))},showPersonalData:function(){this.wishCardData.finisher&&Object.keys(this.wishCardData.finisher).length&&(this.cardShow=!0)},handleClosePop:function(){this.cardShow=!1},handleRecovery:function(){var a=this;n["a"].wishTreeController.deleteWishTree().then((function(t){t.data.meta.success?(a.$notify({type:"success",message:t.data.data}),a.hasSeeding=!1):a.$notify({type:"danger",message:t.data.meta.message})}))},showTips:function(){this.$dialog.alert({title:"许愿树说明",message:"我们会从你喜欢的和喜欢你的人员里面推送他们的愿望种子，如果有人对你的愿望种子浇了水，那么就会有爱心闪动，你可以点击浇水或者点击爱心确定匹配，注意，每个人只能选择一个愿望去实现哦，匹配成功后，点击卡片就可以看到对方信息，剩下的就把握在自己手里啦！"}).then((function(){}))}}},y=C,D=(e("fa1e"),Object(g["a"])(y,s,i,!1,null,"4052f8f3",null));t["default"]=D.exports},e42b:function(a,t,e){"use strict";var s=e("912b"),i=e.n(s);i.a},e731:function(a,t,e){},ea33:function(a,t,e){},fa1e:function(a,t,e){"use strict";var s=e("ea33"),i=e.n(s);i.a}}]);